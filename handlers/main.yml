---
- name: Reload systemd configuration
  service:
    daemon_reload: True

- name: Disable Debian networking
  service:
    name: networking
    enabled: False
    state: stopped
  listen: Configure network services

- name: Restart systemd-networkd
  service:
    name: systemd-networkd
    enabled: True
    state: restarted
  listen: Configure network services

- name: Disable unwanted resolvers
  service:
    name: "{{ item }}"
    enabled: False
    state: stopped
  loop: "{{ _systemd_network_resolv_conf_paths.keys() | difference([systemd_network_dns_resolver]) }}"
  listen: Configure resolver

- name: Enable wanted resolver
  service:
    name: "{{ systemd_network_dns_resolver }}"
    enabled: True
    state: started
  listen: Configure resolver
